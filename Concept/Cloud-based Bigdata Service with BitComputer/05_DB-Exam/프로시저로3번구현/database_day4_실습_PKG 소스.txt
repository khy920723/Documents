CREATE OR REPLACE PACKAGE CURSOR_PKG
AS
TYPE T_CURSOR IS REF CURSOR;
PROCEDURE SP_JOB_HISTORY
(
	IN_EMPLOYEE_ID  IN      EMPLOYEES.EMPLOYEE_ID%TYPE,
	OUT_CURSOR      IN      OUT     T_CURSOR
);
END CURSOR_PKG;

CREATE OR REPLACE PACKAGE BODY CURSOR_PKG
AS
PROCEDURE SP_JOB_HISTORY
(
	IN_EMPLOYEE_ID  IN      EMPLOYEES.EMPLOYEE_ID%TYPE,
	OUT_CURSOR      IN      OUT     T_CURSOR
)
IS
      --OUT_CURSOR    T_CURSOR;
      --CUR_HISTORY   T_CURSOR;
BEGIN
      OPEN OUT_CURSOR FOR
      SELECT E.FIRST_NAME || ' ' || E.LAST_NAME AS NAME
     , JO.JOB_TITLE AS TITLE
      , JH.START_DATE AS SDATE
      , JH.END_DATE AS EDATE
     FROM EMPLOYEES E
             JOIN JOB_HISTORY JH
             ON E.EMPLOYEE_ID = JH.EMPLOYEE_ID
             JOIN JOBS JO
             ON JH.JOB_ID = JO.JOB_ID
     WHERE E.EMPLOYEE_ID = IN_EMPLOYEE_ID;
     --OUT_CURSOR := CUR_HISTORY;
END SP_JOB_HISTORY;
END CURSOR_PKG;

DECLARE
	TYPE T_CURSOR IS REF CURSOR;
	RET_CUR T_CURSOR;
	RET_NAME	VARCHAR2(50);
	RET_TITLE	VARCHAR2(50);
	RET_SDATE	DATE;
	RET_EDATE	DATE;
BEGIN
	CURSOR_PKG.SP_JOB_HISTORY('200', RET_CUR);
	LOOP
		FETCH RET_CUR INTO RET_NAME, RET_TITLE, RET_SDATE, RET_EDATE;
		EXIT WHEN RET_CUR%NOTFOUND;
		DBMS_OUTPUT.PUT_LINE(RET_NAME ||', '||RET_TITLE||', '||RET_SDATE||', '||RET_EDATE);
	END LOOP;
	CLOSE RET_CUR;
END;

